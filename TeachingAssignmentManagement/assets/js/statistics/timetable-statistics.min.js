var termId=$("#term").val(),weekData=$("#weekData"),startWeek=weekData.data("start-week"),endWeek=weekData.data("end-week"),currentWeek=weekData.data("current-week"),rootUrl=$("#loader").data("request-url"),tableStatistics=$("#tblStatistics"),lecturerFilter=$("#lecturerFilter"),lecturerType=$("#lecturerType"),lessonFilter=$("#lessonFilter"),dayFilter=$("#dayFilter"),classCount=$("#tblStatistics .class-card").length;if(0==classCount)$("#timetableStatisticsDiv").empty().append('<h4 class="text-center mt-2">Chưa có dữ liệu <i class="feather feather-help-circle"></i></h4><div class="card-body"><img class="mx-auto p-3 d-block w-50" alt="Welcome" src="'+rootUrl+'assets/images/img_no_data.svg"></div>');else{$('#tblStatistics [data-bs-toggle="tooltip"]').tooltip({trigger:"hover"});var popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')),popoverList=popoverTriggerList.map((function(t){return new bootstrap.Popover(t,{html:!0,sanitize:!1})}));$("#tblStatistics tbody tr").hide(),$(document).on("select2:open",(()=>{document.querySelector(".select2-container--open .select2-search__field").focus()}))}if(!weekSelect.val())if(startWeek<=endWeek){for(var i=startWeek;i<=endWeek;i++)weekSelect.append('<option value="'+i+'">Tuần '+i+"</option>");weekSelect.val(currentWeek)}else timetableStatisticsDiv.empty().append('<h4 class="text-center mt-2">Oops, có vẻ như ban chủ nhiệm khoa của bạn đã đặt tuần bắt đầu lớn hơn tuần kết thúc, vui lòng liên hệ để sửa lỗi.</h4><div class="card-body"><img class="mx-auto p-3 d-block w-50" alt="Welcome" src="'+rootUrl+'assets/images/img_sorry.svg"></div>'),weekSelect.parent().find(".select2-selection__placeholder").text("không khả dụng");function filterCount(t,e){t.parent().find(".select2-search__field").attr("placeholder","Đã chọn "+t.val().length+" "+e)}function resetLecturerFilter(){lecturerFilter.parent().find(".select2-search__field").attr("placeholder","Lọc giảng viên")}function resetLecturerType(){lecturerType.parent().find(".select2-search__field").attr("placeholder","Lọc loại giảng viên")}function updateDivider(){if(tableStatistics.find('thead th[data-startlesson="1"]').is(":hidden")){var t=tableStatistics.find("thead th.lesson-header:visible").first().data("startlesson");tableStatistics.find('td[data-startlesson="'+t+'"]').addClass("table-vertical-divider")}}$.fn.select2.amd.define("select2/selectAllAdapter",["select2/utils","select2/dropdown","select2/dropdown/attachBody"],(function(t,e,a){function l(){}return l.prototype.render=function(t){var e=this,a=t.call(this),l=$('<button class="btn btn-sm text-start filter-button" type="button"><i class="feather feather-check-square"></i> Chọn tất cả</button>'),r=$('<button class="btn btn-sm text-start filter-button" type="button"><i class="feather feather-square"></i> Bỏ chọn tất cả</button>'),i=$('<div class="d-grid"></div>').append(l).append(r);return this.$element.prop("multiple")?(a.find(".select2-dropdown").prepend(i),l.on("click",(function(){lecturerFilter.find("option").prop("selected","selected").trigger("change"),lecturerType.val("-1").trigger("change"),resetLecturerType(),filterCount(lecturerFilter,"GV"),e.trigger("close"),$("#tblStatistics tbody tr").show()})),r.on("click",(function(){lecturerFilter.val("-1").trigger("change"),lecturerType.val("-1").trigger("change"),resetLecturerFilter(),resetLecturerType(),e.trigger("close"),$("#tblStatistics tbody tr").hide()})),a):a},t.Decorate(t.Decorate(e,a),l)})),lecturerFilter.wrap('<div class="position-relative my-50 me-1"></div>'),lecturerFilter.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:lecturerFilter.parent(),dropdownAdapter:$.fn.select2.amd.require("select2/selectAllAdapter")}),resetLecturerFilter(),lecturerFilter.on("select2:select",(function(t){$("#"+t.params.data.id).show(),filterCount(lecturerFilter,"GV")})).on("select2:unselect",(function(t){$("#"+t.params.data.id).hide(),filterCount(lecturerFilter,"GV")})),lecturerType.wrap('<div class="position-relative my-50 me-1"></div>'),lecturerType.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:lecturerType.parent(),placeholder:lecturerType[0][0].innerHTML,minimumResultsForSearch:1/0}),resetLecturerType(),lecturerType.on("select2:select",(function(t){$(this).val("-1").val(t.params.data.id).trigger("change"),lecturerFilter.val("-1").find('option[data-type="'+t.params.data.id+'"]').prop("selected","selected").trigger("change"),filterCount(lecturerFilter,"GV"),lecturerType.parent().find(".select2-search__field").attr("placeholder",t.params.data.text),$("#tblStatistics tbody tr").hide(),$('#tblStatistics tbody tr[data-type="'+t.params.data.id+'"]').show()})).on("select2:unselect",(function(){resetLecturerType()})),lessonFilter.wrap('<div class="position-relative my-50 me-1"></div>'),lessonFilter.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:lessonFilter.parent(),closeOnSelect:!1}),lessonFilter.parent().find(".select2-search__field").attr("placeholder","Lọc ca giảng"),lessonFilter.on("select2:select",(function(t){for(var e=t.params.data.id,a=lessonFilter.val().length,l=dayFilter.val(),r=0;r<l.length;r++){var i=l[r];tableStatistics.find('td[data-day="'+i+'"][data-startlesson="'+e+'"], th[data-day="'+i+'"][data-startlesson="'+e+'"]').show()}tableStatistics.find("thead .day-header").attr("colspan",a),filterCount(lessonFilter,"ca giảng"),tableStatistics.find('td[data-startlesson!="1"]').removeClass("table-vertical-divider"),updateDivider()})).on("select2:unselect",(function(t){var e=t.params.data.id,a=lessonFilter.val().length;tableStatistics.find('td[data-startlesson="'+e+'"], th[data-startlesson="'+e+'"]').hide(),tableStatistics.find("thead .day-header").attr("colspan",a),filterCount(lessonFilter,"ca giảng"),updateDivider()})),dayFilter.wrap('<div class="position-relative my-50"></div>'),dayFilter.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:dayFilter.parent(),closeOnSelect:!1}),dayFilter.parent().find(".select2-search__field").attr("placeholder","Lọc thứ"),dayFilter.on("select2:select",(function(t){for(var e=t.params.data.id,a=lessonFilter.val(),l=0;l<a.length;l++){var r=a[l];tableStatistics.find('thead .day-header[data-day="'+e+'"]').show(),tableStatistics.find('td[data-day="'+e+'"][data-startlesson="'+r+'"], th[data-day="'+e+'"][data-startlesson="'+r+'"]').show()}filterCount(dayFilter,"thứ")})).on("select2:unselect",(function(t){var e=t.params.data.id;tableStatistics.find('td[data-day="'+e+'"], th[data-day="'+e+'"]').hide(),filterCount(dayFilter,"thứ")})),$((function(){"use strict";var t=$("#tour");t.length&&t.on("click",(function(){var t,e,a,l=new Shepherd.Tour({defaultStepOptions:{classes:"shadow-md bg-purple-dark",scrollTo:!1,cancelIcon:{enabled:!0}},useModalOverlay:!0});(t=l,e="btn btn-sm btn-outline-primary",a="btn btn-sm btn-primary btn-next",t.addStep({title:"Chọn tuần",text:"Bạn có thể chọn tuần để xem TKB ờ đây. Mặc định hệ thống sẽ chọn tuần hiện tại.",attachTo:{element:"#week + .select2-container",on:"bottom"},buttons:[{text:"Bỏ qua",classes:e,action:t.cancel},{text:"Tiếp",classes:a,action:t.next}]}),t.addStep({title:"Lọc giảng viên",text:"Chọn giảng viên bạn muốn xem TKB ở đây.",attachTo:{element:"#lecturerFilter + .select2-container",on:"bottom"},buttons:[{text:"Bỏ qua",classes:e,action:t.cancel},{text:"Quay lại",classes:e,action:t.back},{text:"Tiếp",classes:a,action:t.next}]}),t.addStep({title:"Lọc loại giảng viên",text:"Chọn và xem thời khoá biểu theo loại giảng viên ở đây.",attachTo:{element:"#lecturerType + .select2-container",on:"bottom"},buttons:[{text:"Bỏ qua",classes:e,action:t.cancel},{text:"Quay lại",classes:e,action:t.back},{text:"Tiếp",classes:a,action:t.next}]}),t.addStep({title:"Lọc ca giảng",text:"Xem và lọc thời khoá biểu theo ca giảng ở đây.",attachTo:{element:"#lessonFilter + .select2-container",on:"bottom"},buttons:[{text:"Bỏ qua",classes:e,action:t.cancel},{text:"Quay lại",classes:e,action:t.back},{text:"Tiếp",classes:a,action:t.next}]}),t.addStep({title:"Lọc thứ",text:"Xem và lọc theo thứ ở đây.",attachTo:{element:"#dayFilter + .select2-container",on:"bottom"},buttons:[{text:"Quay lại",classes:e,action:t.back},{text:"OK",classes:a,action:t.cancel}]}),t).start()}))}));