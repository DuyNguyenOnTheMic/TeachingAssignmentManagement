var termId=$("#term").val(),weekData=$("#weekData"),startWeek=weekData.data("start-week"),endWeek=weekData.data("end-week"),currentWeek=weekData.data("current-week"),rootUrl=$("#loader").data("request-url"),tableStatistics=$("#tblStatistics"),lecturerFilter=$("#lecturerFilter"),lecturerType=$("#lecturerType"),lessonFilter=$("#lessonFilter"),classCount=$("#tblStatistics .class-card").length;if(0==classCount)$("#timetableStatisticsDiv").empty().append('<h4 class="text-center mt-2">Chưa có dữ liệu <i class="feather feather-help-circle"></i></h4><div class="card-body"><img class="mx-auto p-3 d-block w-50" alt="Welcome" src="'+rootUrl+'assets/images/img_no_data.svg"></div>');else{$('#tblStatistics [data-bs-toggle="tooltip"]').tooltip({trigger:"hover"});var popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')),popoverList=popoverTriggerList.map((function(e){return new bootstrap.Popover(e,{html:!0,sanitize:!1})}));$("#tblStatistics tbody tr").hide(),$(document).on("select2:open",(()=>{document.querySelector(".select2-container--open .select2-search__field").focus()}))}if(!weekSelect.val())if(startWeek<=endWeek){for(var i=startWeek;i<=endWeek;i++)weekSelect.append('<option value="'+i+'">Tuần '+i+"</option>");weekSelect.val(currentWeek)}else timetableStatisticsDiv.empty().append('<h4 class="text-center mt-2">Oops, có vẻ như ban chủ nhiệm khoa của bạn đã đặt tuần bắt đầu lớn hơn tuần kết thúc, vui lòng liên hệ để sửa lỗi.</h4><div class="card-body"><img class="mx-auto p-3 d-block w-50" alt="Welcome" src="'+rootUrl+'assets/images/img_sorry.svg"></div>'),weekSelect.parent().find(".select2-selection__placeholder").text("không khả dụng");function filterCount(e,t){e.parent().find(".select2-search__field").attr("placeholder","Đã chọn "+e.val().length+" "+t)}function resetLecturerFilter(){lecturerFilter.parent().find(".select2-search__field").attr("placeholder","Lọc giảng viên")}function resetLecturerType(){lecturerType.parent().find(".select2-search__field").attr("placeholder","Lọc loại giảng viên")}function updateDivider(){if(tableStatistics.find('thead th[data-startlesson="1"]').is(":hidden")){var e=tableStatistics.find("thead th.lesson-header:visible").first().data("startlesson");tableStatistics.find('td[data-startlesson="'+e+'"]').addClass("table-vertical-divider")}}$.fn.select2.amd.define("select2/selectAllAdapter",["select2/utils","select2/dropdown","select2/dropdown/attachBody"],(function(e,t,a){function r(){}return r.prototype.render=function(e){var t=this,a=e.call(this),r=$('<button class="btn btn-sm text-start filter-button" type="button"><i class="feather feather-check-square"></i> Chọn tất cả</button>'),l=$('<button class="btn btn-sm text-start filter-button" type="button"><i class="feather feather-square"></i> Bỏ chọn tất cả</button>'),i=$('<div class="d-grid"></div>').append(r).append(l);return this.$element.prop("multiple")?(a.find(".select2-dropdown").prepend(i),r.on("click",(function(){lecturerFilter.find("option").prop("selected","selected").trigger("change"),lecturerType.val("-1").trigger("change"),resetLecturerType(),filterCount(lecturerFilter,"GV"),t.trigger("close"),$("#tblStatistics tbody tr").show()})),l.on("click",(function(){lecturerFilter.val("-1").trigger("change"),lecturerType.val("-1").trigger("change"),resetLecturerFilter(),resetLecturerType(),t.trigger("close"),$("#tblStatistics tbody tr").hide()})),a):a},e.Decorate(e.Decorate(t,a),r)})),lecturerFilter.wrap('<div class="position-relative my-50 me-1"></div>'),lecturerFilter.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:lecturerFilter.parent(),dropdownAdapter:$.fn.select2.amd.require("select2/selectAllAdapter")}),resetLecturerFilter(),lecturerFilter.on("select2:select",(function(e){$("#"+e.params.data.id).show(),filterCount(lecturerFilter,"GV")})).on("select2:unselect",(function(e){$("#"+e.params.data.id).hide(),filterCount(lecturerFilter,"GV")})),lecturerType.wrap('<div class="position-relative my-50 me-1"></div>'),lecturerType.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:lecturerType.parent(),placeholder:lecturerType[0][0].innerHTML,minimumResultsForSearch:1/0}),resetLecturerType(),lecturerType.on("select2:select",(function(e){$(this).val("-1").val(e.params.data.id).trigger("change"),lecturerFilter.val("-1").find('option[data-type="'+e.params.data.id+'"]').prop("selected","selected").trigger("change"),filterCount(lecturerFilter,"GV"),lecturerType.parent().find(".select2-search__field").attr("placeholder",e.params.data.text),$("#tblStatistics tbody tr").hide(),$('#tblStatistics tbody tr[data-type="'+e.params.data.id+'"]').show()})).on("select2:unselect",(function(){resetLecturerType()})),lessonFilter.wrap('<div class="position-relative my-50 me-1"></div>'),lessonFilter.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:lessonFilter.parent(),closeOnSelect:!1}),lessonFilter.parent().find(".select2-search__field").attr("placeholder","Lọc ca giảng"),lessonFilter.on("select2:select",(function(e){var t=e.params.data.id,a=lessonFilter.val().length;tableStatistics.find('td[data-startlesson="'+t+'"], th[data-startlesson="'+t+'"]').show(),tableStatistics.find("thead .day-header").attr("colspan",a),filterCount(lessonFilter,"ca giảng"),tableStatistics.find('td[data-startlesson!="1"]').removeClass("table-vertical-divider"),updateDivider()})).on("select2:unselect",(function(e){var t=e.params.data.id,a=lessonFilter.val().length;tableStatistics.find('td[data-startlesson="'+t+'"], th[data-startlesson="'+t+'"]').hide(),tableStatistics.find("thead .day-header").attr("colspan",a),filterCount(lessonFilter,"ca giảng"),updateDivider()})),$((function(){"use strict";var e=$("#tour");e.length&&e.on("click",(function(){var e,t,a,r=new Shepherd.Tour({defaultStepOptions:{classes:"shadow-md bg-purple-dark",scrollTo:!1,cancelIcon:{enabled:!0}},useModalOverlay:!0});(e=r,t="btn btn-sm btn-outline-primary",a="btn btn-sm btn-primary btn-next",e.addStep({title:"Chọn tuần",text:"Bạn có thể chọn tuần để xem TKB ờ đây. Mặc định hệ thống sẽ chọn tuần hiện tại.",attachTo:{element:"#week + .select2-container",on:"bottom"},buttons:[{text:"Bỏ qua",classes:t,action:e.cancel},{text:"Tiếp",classes:a,action:e.next}]}),e.addStep({title:"Lọc giảng viên",text:"Chọn giảng viên bạn muốn xem TKB ở đây.",attachTo:{element:"#lecturerFilter + .select2-container",on:"bottom"},buttons:[{text:"Bỏ qua",classes:t,action:e.cancel},{text:"Quay lại",classes:t,action:e.back},{text:"Tiếp",classes:a,action:e.next}]}),e.addStep({title:"Lọc loại giảng viên",text:"Chọn và xem thời khoá biểu theo loại giảng viên ở đây.",attachTo:{element:"#lecturerType + .select2-container",on:"bottom"},buttons:[{text:"Bỏ qua",classes:t,action:e.cancel},{text:"Quay lại",classes:t,action:e.back},{text:"Tiếp",classes:a,action:e.next}]}),e.addStep({title:"Lọc ca giảng",text:"Xem và lọc thời khoá biểu theo ca giảng ở đây.",attachTo:{element:"#lessonFilter + .select2-container",on:"bottom"},buttons:[{text:"Quay lại",classes:t,action:e.back},{text:"OK",classes:a,action:e.cancel}]}),e).start()}))}));