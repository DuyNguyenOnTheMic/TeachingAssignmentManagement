var titleText,fileName,data,ctx=$("#statistics-chart"),chartWrapper=$(".chartjs"),labelColor="#6e6b7b",titleColor="#666666",gridLineColor="rgba(200, 200, 200, 0.2)",dataLoader=$("#data-loader"),type=dataLoader.data("type"),lecturerType=dataLoader.data("lecturertype"),value=dataLoader.val(),url=rootUrl+"Statistics/";if(type==yearSelect.attr("id")){var yearSplit=value.split(" - "),startYear=yearSplit[0],endYear=yearSplit[1];data={startYear:startYear,endYear:endYear,lecturerType:lecturerType},titleText="Thống kê số giờ năm học "+value,fileName="ThongKeSoGio_NamHoc_"+startYear+"-"+endYear,url+="GetYearData"}else data={termId:value,lecturerType:lecturerType},titleText="Thống kê số giờ học kỳ "+value,fileName="ThongKeSoGio_HK"+value,url+="GetTermData";$("html").hasClass("dark-layout")&&(titleColor="#d0d2d6",labelColor="#b4b7bd"),chartWrapper.length&&chartWrapper.each((function(){$(this).wrap($('<div style="height:'+this.getAttribute("data-height")+'px"></div>'))})),Chart.defaults.font.family="Montserrat,Helvetica,Arial,serif";var chartOptions={indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scaleShowVerticalLines:!1,responsiveAnimationDuration:500,scales:{xAxis:{stacked:!0,grid:{color:gridLineColor,drawTicks:!1},ticks:{color:labelColor}},yAxis:{stacked:!0,grid:{color:gridLineColor},ticks:{autoSkip:!1,color:labelColor}}},plugins:{title:{display:!0,text:titleText,font:{size:25},color:titleColor},datalabels:{color:labelColor},legend:{labels:{color:labelColor}}}};function populateDatatable(t){var e;(e=$("#tblStatistics").DataTable({columns:[{data:"",defaultContent:""},{render:function(){return"<button type='button' class='btn btn-icon btn-icon rounded-circle btn-success waves-effect waves-float waves-light p-25 viewInfo' title='Xem môn học'><i class='feather feather-plus'></i></button>"}},{data:"staff_id"},{data:"full_name"},{data:"curriculum_count"},{render:function(t,e,a,l){var s,r=a.theory_count+"LT",o=a.practice_count+"TH";return a.theory_count&&a.practice_count?s=r+" + "+o:a.theory_count?s=r:a.practice_count&&(s=o),s}},{data:"sum"}],data:t,columnDefs:[{searchable:!1,orderable:!1,width:"5%",targets:[0,1]},{className:"text-center",target:[0,1,4,5,6]}],order:[[6,"desc"]],dom:'<"d-flex justify-content-between align-items-center header-actions mx-2 row mt-75"<"col-sm-12 col-lg-4 d-flex justify-content-center justify-content-lg-start" l><"col-sm-12 col-lg-8 ps-xl-75 px-0"<"dt-action-buttons d-flex align-items-center justify-content-center justify-content-lg-end flex-lg-nowrap flex-wrap"<"me-1"f>B>>>t<"d-flex justify-content-between mx-2 row mb-1"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',displayLength:10,lengthMenu:[[10,25,50,-1],[10,25,50,"tất cả"]],buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle me-2",text:feather.icons.share.toSvg({class:"font-small-4 me-50"})+"Export",buttons:[{extend:"print",className:"dropdown-item",title:fileName,exportOptions:{columns:[0,2,3,4,5,6]}},{extend:"excel",className:"dropdown-item",title:fileName,exportOptions:{columns:[0,2,3,4,5,6]}},{extend:"pdf",className:"dropdown-item",title:fileName,exportOptions:{columns:[0,2,3,4,5,6]}},{extend:"copy",className:"dropdown-item",title:fileName,exportOptions:{columns:[0,2,3,4,5,6]}}],init:function(t,e,a){$(e).removeClass("btn-secondary"),$(e).parent().removeClass("btn-group"),setTimeout((function(){$(e).closest(".dt-buttons").removeClass("btn-group").addClass("d-inline-flex mt-50")}),50)}}],language:{url:rootUrl+"app-assets/language/datatables/vi.json"}})).on("draw.dt",(function(){e.column(0,{search:"applied",order:"applied"}).nodes().each((function(t,a){t.innerHTML=a+1,e.cell(t).invalidate("dom")}))})),$("#tblStatistics tbody").on("click","td .viewInfo ",(function(){var t=$(this),a=t.closest("tr"),l=e.row(a);l.child.isShown()?(t.removeClass("btn-danger").addClass("btn-success"),t.find("i").removeClass("feather-minus").addClass("feather-plus"),l.child.hide(),a.removeClass("shown")):(t.removeClass("btn-success").addClass("btn-danger"),t.find("i").removeClass("feather-plus").addClass("feather-minus"),l.child(format(l.data())).show(),a.addClass("shown"))}))}function format(t){for(var e=t.curriculum_id,a=t.curriculum_name,l=t.curriculum_credits,s=t.curriculum_major,r=t.curriculum_hours,o=e.length,n="",i=0;i<o;i++)n+="<tr><td>"+e[i]+"</td><td>"+a[i]+"</td><td>"+s[i]+'</td><td class="text-center">'+l[i]+'</td><td class="text-center">'+r[i]+"</td></tr>";return'<table class="table table-sm"><thead class="table-light"><tr><th>Mã HP</th><th>Tên HP</th><th>Ngành</th><th class="text-center">Số TC</th><th class="text-center">Số giờ</th></tr></thead><tbody>'+n+"</tbody></table>"}$.ajax({type:"GET",url:url,data:data,async:!1,success:function(t){if(t.length){var e=t.map((function(t){return t.full_name})),a=t.map((function(t){return t.sum})),l=new Chart(ctx,{type:"bar",data:{labels:e,datasets:[{label:"Số giờ giảng",data:a,backgroundColor:"rgba(115, 103, 240, 0.8)",borderColor:"transparent",borderWidth:1,datalabels:{anchor:"end",align:"start",offset:-30}}]},options:chartOptions,plugins:[ChartDataLabels]});$(".nav-link-style").on("click",(function(){var t,e;$("html").hasClass("dark-layout")?(t="#d0d2d6",e="#b4b7bd"):(t="#666666",e="#6e6b7b"),l.options.plugins.title.color=t,l.options.plugins.datalabels.color=e,l.options.plugins.legend.labels.color=e,l.options.scales.xAxis.ticks.color=e,l.options.scales.yAxis.ticks.color=e,l.update()})),populateDatatable(t)}else statisticsDiv.empty().append('<h4 class="text-center mt-2">Chưa có dữ liệu <i class="feather feather-help-circle"></i></h4><div class="card-body"><img class="mx-auto p-3 d-block w-50" alt="Welcome" src="'+rootUrl+'assets/images/img_no_data.svg"></div>')}}),$('a[data-bs-toggle="tab"]').on("shown.bs.tab",(function(t){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()}));