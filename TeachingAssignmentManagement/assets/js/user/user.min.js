var popup,dataTable,rootUrl=$("#loader").data("request-url"),typeBadgeObj={CH:{title:"Cơ hữu",class:"badge-light-success"},TG:{title:"Thỉnh giảng",class:"badge-light-warning"}};function refreshTable(){dataTable.ajax.reload(null,!1)}function disableButtons(e){!0===e?($(".createNew").prop("disabled",!0),$(".editRow").each((function(){this.style.pointerEvents="none"})),$(".deleteRow").each((function(){this.style.pointerEvents="none"}))):($(".createNew").prop("disabled",!1),$(".editRow").each((function(){this.style.pointerEvents="auto"})),$(".deleteRow").each((function(){this.style.pointerEvents="auto"})))}function filterCount(e){e.parent().find(".select2-search__field").attr("placeholder","Đã chọn "+e.val().length+" cột")}function editStatus(e,t){$.ajax({type:"POST",url:rootUrl+"User/EditStatus/",data:{id:e,status:t},success:function(e){e.success&&(refreshTable(),toastr.success(e.message))}})}function popupForm(e){var t=$("<div />");$.get(e).done((function(e){t.html(e),popup=t.dialog({autoOpen:!0,resizable:!1,title:"Quản lý người dùng",width:550,open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").addClass("btn-close"),disableButtons(!0)},close:function(){popup.dialog("destroy").remove(),disableButtons(!1)}})}))}function submitForm(e){return $.validator.unobtrusive.parse(e),$(e).valid()&&$.ajax({type:"POST",url:e.action,data:$(e).serialize(),success:function(e){e.success?(popup.dialog("close"),refreshTable(),toastr.success(e.message)):Swal.fire({title:"Thông báo",text:e.message,icon:"error",customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1})}}),!1}function deleteUser(e,t){"null"==t&&(t=""),Swal.fire({title:"Thông báo",text:"Bạn có chắc muốn xoá người dùng "+t+" này?",icon:"warning",showCancelButton:!0,cancelButtonText:"Huỷ",confirmButtonText:"Xoá",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-outline-danger ms-1"},buttonsStyling:!1}).then((t=>{t.isConfirmed&&$.ajax({type:"POST",url:rootUrl+"User/Delete/"+e,success:function(e){e.success?(refreshTable(),toastr.success(e.message)):Swal.fire({title:"Thông báo",text:e.message,icon:"error",customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1})}})}))}$((function(){"use strict";(dataTable=$("#tblUser").DataTable({ajax:{url:rootUrl+"User/GetData",type:"GET",dataType:"json",dataSrc:""},deferRender:!0,columns:[{data:"",defaultContent:""},{data:"staff_id"},{data:"full_name"},{data:"email"},{data:"type"},{data:"role"},{data:"status"},{data:"id",render:function(e,t,a){return"<a class='editRow text-success p-0' data-original-title='Chỉnh sửa' title='Chỉnh sửa' onclick=popupForm('"+rootUrl+"User/Edit/"+e+"')><i class='feather feather-edit font-medium-3 me-1'></i></a><a class='deleteRow text-danger p-0' data-original-title='Xoá' title='Xoá' onclick=deleteUser('"+e+"','"+a.email+"')><i class='feather feather-trash-2 font-medium-3 me-1'></i></a>"}}],columnDefs:[{targets:4,render:function(e){var t=e;return t?'<span class="badge rounded-pill '+typeBadgeObj[t].class+' text-capitalized">'+typeBadgeObj[t].title+"</span>":null}},{targets:5,render:function(e,t,a,n){var o=a.role;return'<span class="text-truncate align-middle">'+{"BCN khoa":feather.icons.command.toSvg({class:"font-medium-3 text-primary me-50"}),"Bộ môn":feather.icons.book.toSvg({class:"font-medium-3 text-danger me-50"}),"Giảng viên":feather.icons["edit-2"].toSvg({class:"font-medium-3 text-success me-50"}),"Chưa phân quyền":feather.icons["help-circle"].toSvg({class:"font-medium-3 text-warning me-50"})}[o]+o+"</span>"}},{targets:6,visible:!1,render:function(e,t,a){var n=e,o=n?"checked":"";return"display"===t?"<div class='form-check form-check-primary form-switch d-flex justify-content-center'><input type='checkbox' class='form-check-input user-status' aria-label='Trạng thái người dùng' onchange=editStatus('"+a.id+"','"+!n+"') "+o+"></div>":e}},{searchable:!1,orderable:!1,targets:[0,7]},{className:"text-center",targets:[0,6,7]},{width:"5%",targets:0},{width:"10%",targets:7}],order:[[3,"asc"]],dom:'<"d-flex justify-content-between align-items-center header-actions mx-2 row mt-75"<"col-sm-12 col-lg-4 d-flex justify-content-center justify-content-lg-start" l<"column-filter mx-2">><"col-sm-12 col-lg-8 ps-xl-75 px-0"<"dt-action-buttons d-flex align-items-center justify-content-center justify-content-lg-end flex-lg-nowrap flex-wrap"<"me-1"f>B>>>t<"d-flex justify-content-between mx-2 row mb-1"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',lengthMenu:[[10,25,50,-1],[10,25,50,"tất cả"]],buttons:[{text:"Thêm người dùng",className:"createNew btn btn-primary",attr:{onclick:"popupForm('"+rootUrl+"User/Create')"},init:function(e,t,a){$(t).removeClass("btn-secondary"),$(t).parent().removeClass("btn-group"),setTimeout((function(){$(t).closest(".dt-buttons").removeClass("btn-group").addClass("d-inline-flex mt-50")}),50)}}],language:{url:rootUrl+"app-assets/language/datatables/vi.json"},initComplete:function(){this.api().columns(4).every((function(){var e=this,t=$('<select id="UserType" class="form-select text-capitalize mb-md-0 mb-2xx"><option value=""> Chọn loại GV để lọc </option></select>').appendTo(".user_type").on("change",(function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()}));e.data().unique().sort().each((function(e,a){e&&t.append('<option value="'+typeBadgeObj[e].title+'" class="text-capitalize">'+typeBadgeObj[e].title+"</option>")}))})),this.api().columns(5).every((function(){var e=this,t=$('<select id="UserRole" class="form-select text-capitalize mb-md-0 mb-2"><option value=""> Chọn role để lọc </option></select>').appendTo(".user_role").on("change",(function(){var t=$.fn.dataTable.util.escapeRegex($(this).val());e.search(t?"^"+t+"$":"",!0,!1).draw()}));e.data().unique().sort().each((function(e,a){t.append('<option value="'+e+'" class="text-capitalize">'+e+"</option>")}))})),$("div.column-filter").html('<div class="dataTables_showhide"><label><select class="form-select" id="columnFilter" name="columnFilter" multiple="multiple"><option value="1" selected="selected">Mã giảng viên</option><option value="2" selected="selected">Tên giảng viên</option><option value="3" selected="selected">Email</option><option value="4" selected="selected">Loại</option><option value="5" selected="selected">Role</option><option value="6">Trạng thái</option></select></label></div>');var e=$("#columnFilter");e.wrap('<div class="position-relative"></div>').select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:e.parent(),closeOnSelect:!1}),e.parent().find(".select2-search__field").attr("placeholder","Ẩn/ hiện cột"),e.on("select2:select select2:unselect",(function(e){var t=dataTable.column(e.params.data.id);t.visible(!t.visible()),filterCount($(this))}))}})).on("draw.dt",(function(){dataTable.column(0,{search:"applied",order:"applied"}).nodes().each((function(e,t){e.innerHTML=t+1}));var e=dataTable.column(5).data().filter((function(e,t){return"BCN khoa"===e})).length,t=dataTable.column(5).data().filter((function(e,t){return"Bộ môn"===e})).length,a=dataTable.column(5).data().filter((function(e,t){return"Giảng viên"===e})).length,n=dataTable.column(5).data().filter((function(e,t){return"Chưa phân quyền"===e})).length;$("#totalFBoard").text(e),$("#totalDHead").text(t),$("#totalLecturer").text(a),$("#totalUnassigned").text(n),!0===$(".ui-dialog-content").dialog("isOpen")?disableButtons(!0):disableButtons(!1)}))}));