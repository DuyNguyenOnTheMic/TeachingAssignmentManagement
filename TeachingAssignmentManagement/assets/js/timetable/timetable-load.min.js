var formSelect=$(".form-select"),rootUrl=$("#loader").data("request-url"),assignLecturerDiv=$("#assignLecturerDiv"),url=rootUrl+"Timetable/GetData",hubNotif=$.connection.timetableHub;function populateSelect(t){t.wrap('<div class="position-relative"></div>'),t.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:t.parent(),placeholder:t[0][0].innerHTML,allowClear:!0})}function updateClass(t,e,a,n){var o=t.data("classtype"),i=t.parent(),r=i.attr("data-bs-original-title").split("<br /><b>Phân công bởi: </b>")[0];t.attr("data-lecturerid",e),t.removeClass("btn-success btn-warning btn-secondary unassigned-theory unassigned-practical"),i.tooltip("dispose"),e?("Lý thuyết"==o?t.addClass("btn-success"):t.addClass("btn-warning"),i.attr("title",r+"<br /><b>Phân công bởi: </b>"+n),a=splitString(a)):(a="Chưa phân","Lý thuyết"==o?t.addClass("btn-secondary unassigned-theory"):t.addClass("btn-secondary unassigned-practical"),i.attr("title",r)),t.text(a),i.tooltip({trigger:"hover"}),$('[data-bs-toggle="popover"]').popover("update")}function updateCount(){var t=$("#assignedCount"),e=$("#totalCount"),a=$("#tblAssign tbody .assign-card"),n=$("#tblAssign tbody .btn-success"),o=$("#tblAssign tbody .btn-warning");t.text(n.length+o.length),e.text(a.length)}function fetchData(){var t=$("#term").val(),e=$("#major").val();t&&e?getTimetable(t,e):showNoData(assignLecturerDiv,"học kỳ")}function getTimetable(t,e){$("#tblAssign [data-bs-toggle='tooltip']").tooltip("dispose"),$("#tblAssign [data-bs-toggle='popover']").popover("dispose"),t&&e&&(showLoading(assignLecturerDiv),$.get(url,{termId:t,majorId:e},(function(t){assignLecturerDiv.html(t)})))}$.connection.hub.start(),hubNotif.client.updatedData=function(t,e,a,n,o){var i=$("#"+t);i.length&&(o?updateClass(i,e,a,n):(i.parent().tooltip("dispose"),i.popover("dispose"),i.remove()),updateCount())},hubNotif.client.refreshedData=function(t,e){t==termId&&e==majorId?getTimetable(t,e):t==termId&&-1==majorId?getTimetable(t,e=-1):t==termId&&null==e&&getTimetable(t,majorId)},$((function(){formSelect.each((function(){var t=$(this);t.val(t.find("option:first").next().val())})),$("#major option:first").after('<option value="-1">Tất cả</option>'),formSelect.each((function(){var t=$(this);t.wrap('<div class="position-relative"></div>'),t.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:t.parent(),placeholder:t[0][0].innerHTML})})),fetchData()})),formSelect.change((function(){fetchData()}));