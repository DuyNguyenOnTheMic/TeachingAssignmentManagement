var formSelect=$(".form-select"),rootUrl=$("#loader").data("request-url"),classTypeData=$("#classTypeData"),theoreticalClassType=classTypeData.data("theoreticalclasstype"),practiceClassType=classTypeData.data("practiceclasstype"),assignLecturerDiv=$("#assignLecturerDiv"),url=rootUrl+"Timetable/GetData",hubNotif=$.connection.timetableHub;function populateSelect(t){t.wrap('<div class="position-relative"></div>'),t.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:t.parent(),placeholder:t[0][0].innerHTML,allowClear:!0})}function updateClass(t,a,e,s){var o=t.data("classtype"),n=t.parent(),i=n.attr("data-bs-original-title").split("<br /><b>Phân công bởi: </b>")[0];t.attr("data-lecturerid",a),t.removeClass("btn-success btn-warning btn-secondary unassigned-theory unassigned-practical"),n.tooltip("dispose"),a?(o==theoreticalClassType?t.addClass("btn-success"):t.addClass("btn-warning"),n.attr("title",i+"<br /><b>Phân công bởi: </b>"+s),e=splitString(e)):(e="Chưa phân",o==theoreticalClassType?t.addClass("btn-secondary unassigned-theory"):t.addClass("btn-secondary unassigned-practical"),n.attr("title",i)),t.text(e),n.tooltip({trigger:"hover"}),$('[data-bs-toggle="popover"]').popover("update")}function updateTotalCount(){var t=$("#assignedCount"),a=$("#totalCount"),e=$("#tblAssign tbody .assign-card"),s=$("#tblAssign tbody .btn-success"),o=$("#tblAssign tbody .btn-warning");t.text(s.length+o.length),a.text(e.length)}function updateClassCount(t){var a=$("#theoreticalCount"),e=$("#practicalCount"),s=!1===t?"":":visible",o=$('#tblAssign tbody .assign-card[data-classtype="'+theoreticalClassType+'"]'+s),n=$('#tblAssign tbody .assign-card[data-classtype="'+practiceClassType+'"]'+s);a.text(o.length),e.text(n.length)}function fetchData(){var t=$("#term").val(),a=$("#major").val();t&&a?getTimetable(t,a):showNoData(assignLecturerDiv,"học kỳ")}function getTimetable(t,a){$("#tblAssign [data-bs-toggle='tooltip']").tooltip("dispose"),$("#tblAssign [data-bs-toggle='popover']").popover("dispose"),showLoading(assignLecturerDiv),$.get(url,{termId:t,majorId:a},(function(t){assignLecturerDiv.html(t)}))}$.connection.hub.start(),hubNotif.client.updatedData=function(t,a,e,s,o){var n=$("#"+t);n.length&&(o?updateClass(n,a,e,s):(n.parent().tooltip("dispose"),n.popover("dispose"),n.remove(),updateClassCount(!1)),updateTotalCount())},hubNotif.client.refreshedData=function(t,a){t==termId&&a==majorId?getTimetable(t,a):t==termId&&-1==majorId?getTimetable(t,a=-1):t==termId&&null==a&&getTimetable(t,majorId)},$((function(){formSelect.each((function(){var t=$(this);t.val(t.find("option:first").next().val())})),$("#major option:first").after('<option value="-1">Tất cả</option>'),formSelect.each((function(){var t=$(this);t.wrap('<div class="position-relative"></div>'),t.select2({language:"vi",dropdownAutoWidth:!0,dropdownParent:t.parent(),placeholder:t[0][0].innerHTML})})),fetchData()})),formSelect.change((function(){fetchData()}));