var termId=$("#term").val(),majorId=$("#major").val(),rootUrl=$("#loader").data("request-url");$((function(){updateCount()}));var rowCount=$("#tblAssign tbody tr").length;if(0==rowCount)$("#assignLecturerDiv").empty().append('<h4 class="text-center mt-2">Học kỳ này chưa có dữ liệu <i class="feather feather-help-circle"></i></h4><div class="card-body"><img class="mx-auto p-3 d-block w-50" alt="Welcome" src="'+rootUrl+'assets/images/img_no_data.svg"></div>');else{$('#tblAssign [data-bs-toggle="tooltip"]').tooltip({trigger:"hover"});var popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')),popoverList=popoverTriggerList.map((function(t){return new bootstrap.Popover(t,{html:!0,sanitize:!1})}))}function splitString(t){return t.substring(0,t.lastIndexOf(" ")).split(" ").map((function(t){return t[0]})).join(".")+" "+t.split(" ").pop()}function assignLecturer(t,e){$.ajax({type:"POST",url:rootUrl+"Timetable/Assign",data:{id:t,lecturerId:e},success:function(t){t.success?(toastr.options.positionClass="toast-bottom-right",toastr.success("Thành công!")):Swal.fire({title:"Thông báo",html:t.message,icon:"error",customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1})}})}$(".assign-card").each((function(){var t=$(this),e=t.data("lecturerid"),s=t.text();""!=e?t.text(splitString(s)):t.hasClass("btn-success")?t.removeClass("btn-success").addClass("btn-secondary unassigned-theory"):t.removeClass("btn-warning").addClass("btn-secondary unassigned-practical")})),$(document).off("click",".btn-assign").on("click",".btn-assign",(function(){$this=$(this);var t=$this.data("id"),e=$this.parent().find(".select2 :selected").val();$.ajax({type:"GET",url:rootUrl+"Timetable/CheckState",data:{id:t,termId:termId,lecturerId:e},success:function(s){if(s.success)assignLecturer(t,e);else{let t=s.message+'<div class="table-responsive mt-2"><table class="table table-sm"><thead class="text-nowrap"><tr><th></th><th>Mã LHP</th><th>Tên HP</th><th>Thứ</th><th>Tiết</th><th>Ngành</th></tr></thead><tbody>';s.classList.forEach((function(e,s){t+='<tr class="font-small-3"><td>'+(s+1)+"</td><td>"+e.classId+"</td><td>"+e.curriculumName+'</td><td class="text-nowrap">'+e.classDay+'</td><td class="text-nowrap">'+e.lessonTime+"</td><td>"+e.majorName+"</td></tr>"})),t+="</tbody></table></div>",Swal.fire({title:"Thông báo",width:800,html:t,icon:"error",customClass:{confirmButton:"btn btn-primary"},buttonsStyling:!1})}}})})),$(document).off("click",".btn-delete").on("click",".btn-delete",(function(){$this=$(this);var t=$this.data("id"),e=$this.parents().find(".popover-header").find(".class-id").text();Swal.fire({title:"Thông báo",html:'<p class="text-danger mb-0">Hãy nhập lại mã lớp học phần, '+e+" để xác nhận xoá.</p>",icon:"warning",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,cancelButtonText:"Huỷ",confirmButtonText:"Xoá",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-outline-danger ms-1"},buttonsStyling:!1,preConfirm:s=>{if(s!==e)return Swal.showValidationMessage("Xác nhận xoá thất bại!"),!1;$.ajax({type:"POST",url:rootUrl+"Timetable/Delete",data:{id:t},success:function(t){t.success&&(toastr.options.positionClass="toast-bottom-right",toastr.success("Xoá lớp thành công!"))}})}})})),$(".assign-card").on("click",(function(){$('[data-bs-toggle="popover"]').not(this).popover("hide")})).on("show.bs.popover",(function(){setTimeout((()=>{var t=$(".popover-body .form-select");if($(t).hasClass("select2-hidden-accessible")){var e=$(this).data("lecturerid");t.val(e).trigger("change")}else populateSelect(t),t.on("select2:open",(()=>{document.querySelector(".select2-search__field").focus()}))}),0)})),$("#tblAssign").on("click",(function(){$('[data-bs-toggle="popover"]').popover("hide")})),$(".btn-export").on("click",(function(){var t=rootUrl+"TimeTable/Export?termId="+termId+"&majorId="+majorId;window.open(t,"_blank").focus()}));