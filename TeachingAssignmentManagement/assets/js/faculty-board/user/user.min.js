var popup,dataTable;function popupForm(t){var e=$("<div />");$.get(t).done(function(t){e.html(t),popup=e.dialog({autoOpen:!0,resizable:!1,title:"Quản l\xfd người d\xf9ng",width:550,open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").addClass("btn-close"),$(".createNew").prop("disabled",!0),$(".editRow").each(function(){this.style.pointerEvents="none"}),$(".deleteRow").each(function(){this.style.pointerEvents="none"})},close:function(){popup.dialog("destroy").remove(),$(".createNew").prop("disabled",!1),$(".editRow").each(function(){this.style.pointerEvents="auto"}),$(".deleteRow").each(function(){this.style.pointerEvents="auto"})}})})}function submitForm(t){return $.validator.unobtrusive.parse(t),$(t).valid()&&$.ajax({type:"POST",url:t.action,data:$(t).serialize(),success:function(t){t.success?(popup.dialog("close"),dataTable.ajax.reload(null,!1),toastr.options.positionClass="toast-bottom-right",toastr.success(t.message)):Swal.fire({title:"Th\xf4ng b\xe1o",text:t.message,icon:"error",customClass:{confirmButton:"btn btn-primary"}})}}),!1}function deleteUser(t,e){Swal.fire({title:"Th\xf4ng b\xe1o",text:"Bạn c\xf3 chắc muốn xo\xe1 người d\xf9ng "+e+" n\xe0y?",icon:"warning",showCancelButton:!0,cancelButtonText:"Huỷ",confirmButtonText:"Xo\xe1",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-outline-danger ms-1"}}).then(e=>{e.isConfirmed&&$.ajax({type:"POST",url:"User/Delete/"+t,success:function(t){t.success?(dataTable.ajax.reload(null,!1),toastr.options.positionClass="toast-bottom-right",toastr.success(t.message)):Swal.fire({title:"Th\xf4ng b\xe1o",text:t.message,icon:"error",customClass:{confirmButton:"btn btn-primary"}})}})})}$(function(){"use strict";(dataTable=$("#tblUser").DataTable({ajax:{url:"User/GetData",type:"GET",dataType:"json",dataSrc:""},deferRender:!0,columns:[{data:"",defaultContent:""},{data:"staff_id"},{data:"full_name"},{data:"email"},{data:"role"},{data:"id",render:function(t,e,n){return"<a class='editRow text-success p-0' data-original-title='Edit' title='Edit' onclick=popupForm('User/Edit/"+t+"')><i class='feather feather-edit font-medium-3 me-1'></i></a> <a class='deleteRow text-danger p-0' data-original-title='Delete' title='Delete' onclick=deleteUser('"+t+"','"+n.email+"')><i class='feather feather-trash-2 font-medium-3 me-1'></i></a>"}}],columnDefs:[{targets:4,render:function(t,e,n,a){var o=n.role;return"<span class='text-truncate align-middle'>"+({"BCN khoa":feather.icons.command.toSvg({class:"font-medium-3 text-primary me-50"}),"Bộ m\xf4n":feather.icons.book.toSvg({class:"font-medium-3 text-danger me-50"}),"Giảng vi\xean":feather.icons["edit-2"].toSvg({class:"font-medium-3 text-success me-50"}),"Chưa ph\xe2n quyền":feather.icons["help-circle"].toSvg({class:"font-medium-3 text-warning me-50"})})[o]+o+"</span>"}},{searchable:!1,orderable:!1,className:"text-center",targets:[0,5]},{width:"5%",targets:0},{width:"10%",targets:5}],order:[[3,"asc"]],dom:'<"d-flex justify-content-between align-items-center header-actions mx-2 row mt-75"<"col-sm-12 col-lg-4 d-flex justify-content-center justify-content-lg-start" l><"col-sm-12 col-lg-8 ps-xl-75 ps-0"<"dt-action-buttons d-flex align-items-center justify-content-center justify-content-lg-end flex-lg-nowrap flex-wrap"<"me-1"f>B>>>t<"d-flex justify-content-between mx-2 row mb-1"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',lengthMenu:[[10,25,50,-1],[10,25,50,"tất cả"]],buttons:[{text:"Th\xeam người d\xf9ng",className:"createNew btn btn-primary",attr:{onclick:"popupForm('User/Create')"},init:function(t,e,n){$(e).removeClass("btn-secondary"),$(e).parent().removeClass("btn-group"),setTimeout(function(){$(e).closest(".dt-buttons").removeClass("btn-group").addClass("d-inline-flex mt-50")},50)}}],language:{url:"/app-assets/language/vi.json"},initComplete:function(){this.api().columns(4).every(function(){var t=this,e=$('<select id="UserRole" class="form-select text-capitalize mb-md-0 mb-2"><option value=""> Chọn role để lọc </option></select>').appendTo(".user_role").on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());t.search(e?"^"+e+"$":"",!0,!1).draw()});t.data().unique().sort().each(function(t,n){e.append('<option value="'+t+'" class="text-capitalize">'+t+"</option>")})})}})).on("draw.dt",function(){dataTable.column(0,{search:"applied",order:"applied"}).nodes().each(function(t,e){t.innerHTML=e+1});var t=dataTable.column(4).data().filter(function(t,e){return"BCN khoa"===t}).length,e=dataTable.column(4).data().filter(function(t,e){return"Bộ m\xf4n"===t}).length,n=dataTable.column(4).data().filter(function(t,e){return"Giảng vi\xean"===t}).length,a=dataTable.column(4).data().filter(function(t,e){return"Chưa ph\xe2n quyền"===t}).length;$("#totalFBoard").text(t),$("#totalDHead").text(e),$("#totalLecturer").text(n),$("#totalUnassigned").text(a)})});